<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>压力标定</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>   <!-- 引入Chart.js -->
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }

        .chart-container {
            width: 80%;
            height: 400px;
        }

        button {
            margin-top: 20px;
        }

        select {
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div class="chart-container" id="chartContainer">
    <!--居中展示-->
    <div style="align-content: center">
        <button onclick="getDataClean()">清除数据</button>
        <input type="text" id="inputField" placeholder="砝码重量"/>
        <select id="jzSelector">
            <option value="0">模式一砝码基准</option>
            <option value="0">模式二基准一</option>
            <option value="1">模式三基准一</option>
            <option value="2">模式三基准二</option>
        </select>
        <button onclick="getDataMatch()">数据采集</button>
    </div>
    <canvas id="lineChart" width="800" height="400"></canvas>
</div>
<script>
    // 初始化图表的函数
    function initChart(ctx, data) {
        return new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                scales: {
                    x: {
                        type: 'linear', // 使用线性类型的X轴
                        position: 'bottom',
                        ticks: {
                            source: 'labels', // 从labels属性获取标签
                            stepSize: 1, // 控制标签的显示间隔
                            autoSkip: true, // 自动跳过标签
                        },
                        title: {
                            display: true,
                            text: '拉力'
                        }
                    },
                    y: {
                        beginAtZero: false,
                        suggestedMin: 0, // 设置Y轴的最小值为0
                        ticks: {
                            stepSize: 25
                        },
                        title: {
                            display: true,
                            text: '重力'
                        }
                    }
                }
            }
        });
    }

    // 获取图表上下文并初始化图表
    var ctx = document.getElementById('lineChart').getContext('2d');
    var lineChart = initChart(ctx, {
        labels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
        datasets: [
            {
                label: '压力传感器校准',
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1,
                data: [],
                tension: 0
            }
        ]
    });

    // 从服务器获取数据并更新图表的函数
    function getDataClean() {
        lineChart.data.labels = null;
        lineChart.data.datasets[0].data = null;
        lineChart.update();
        var apiUrl = 'http://192.168.0.5:55055/data/hsy/dataClean';  // 修正URL拼接
        fetch(apiUrl)
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Network response was not ok.');
            })
            .then(data => {
                //alert("串口绑定-" + data.comBinding);
                //提示采集成功
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
                alert("初始化失败");
            });
    }

    // 从服务器获取数据并更新图表的函数
    function getDataMatch() {
        var inputText = document.getElementById('inputField').value;
        var jzSelector = document.getElementById('jzSelector').value;
        var apiUrl = 'http://192.168.0.5:55055/data/hsy/dataMatch?weight=' + inputText + "&jzSelector=" + jzSelector; // 修正URL拼接

        fetch(apiUrl)
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Network response was not ok.');
            })
            .then(data => {
                updateChart(lineChart, data);
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
                alert("数据采集失败");
            });
    }

    // 更新图表的函数
    function updateChart(chart, data) {
        chart.data.labels = data.labels;
        chart.data.datasets[0].data = data.datasets[0].data;
        chart.update();
    }

    //页面加载的时候初始化
    window.onload = function () {
        getDataClean();
        document.body.requestFullscreen().catch(err => {
            if (err) {
                // 处理无法全屏的情况，例如用户拒绝或浏览器不支持
                console.error("Unable to fullscreen: " + err.message);
            }
        });
    };
</script>
</body>
</html>